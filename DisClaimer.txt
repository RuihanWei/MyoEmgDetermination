Modified based on Thalmic Labs' SDK sample code